---
title: "Introduction to theme61"
output: rmarkdown::html_vignette
description: Some example code showing how to use `theme61` with `ggplot2` graphs.
vignette: >
  %\VignetteIndexEntry{Introduction to theme61}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r echo = FALSE, message = FALSE, warning = FALSE}
devtools::load_all()
library(ggplot2)
library(data.table)

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

`theme61` is an extension to `ggplot2`. It is made up of a custom theme and functions that change the appearance of a standard `ggplot2` graph. Thus, the correct usage of this package is to create your normal `ggplot2` graph, then add `theme61`-specific elements. 

You should read this article and the [Graph standards](graph-standards.html) article to help you understand how to create graphs following the e61 graph standards. 

This article provides some examples to help you figure out what elements you can change. The function documentation provides comprehensive information on the full customisability of the package.

## The colour palette

```{r colour-palette-chart, echo = FALSE}
source("colour-palette.R", print.eval = TRUE)
```

## Workflow

When making graphs, you should follow the below workflow. 

### New to ggplot - start here

If you're new to R and ggplot, or just want to explore your data, start by using `e61_chart_maker()`. It has limited functionality, but should help you learn the basics of ggplot and create charts quickly.

### Experienced users - start here

Start by creating a simple graph using the 'normal' stuff: `ggplot(data, aes(x =, y =, col =, fill =)) + facet_wrap(vars(var_blah)) + geom_blah()`

Then:

- (optional) Manually add graph colours if the auto colour scaling has not worked properly: `scale_colour_e61()` or `scale_fill_e61()`
- (optional) Manually format the x and y axes scales if you are not happy with the auto y-axis scaling: `scale_y_continuous_e61()`, `scale_x_continuous_e61()`
- Add on plot labels: `mplot_label()` or `plot_label()`
- Add titles, axes labels, footnotes and sources: `labs_e61(title = "Title", footnotes = "Footnotes", sources = c("Source 1", "Source 2"))`
  - Note 1: You no longer need to specify title_max_char etc. manually as the titles and footnotes are now automatically scaled when the chart is saved. If you want, you can still specify the max_char variables manually if you are unhappy with the automatic scaling.
  - Note 2: To comply with the current theme61 style, your y-axis labels should by no longer than 5 characters. You should use the subtitle to describe your y variable and the y-axis label should be used to specify the units (e.g. \$, %, 000s, \$000s).
- Save the graph: `save_e61()` (always save your graph using `save_e61()`. Do **not** use the Export button in the Plots tab or `ggsave()`)
  - Note 1: Multi-panel charts are now created using `save_e61()`, `mpanel()` has been retired. For example, to create an multi-panel chart with charts fig1a and fig1b, you would use `save_e61(fig1a, fig1b, filename = "blah", title = "mpanel title blah", subtitle = "mpanel subtitle blah", footnotes = "mpanel footnotes blah", sources = "e61 Institute")` 
  - Note 2: There is a new argument called chart_type, which has three possible values "MN" (micronote, the default), "RN" (research note) and "PPT" (PowerPoint). This adjusts the chart size and text size for each output type.
  - Note 3: There is a new argument called bg_colour which is used to set the background colour of the chart. The default is white, but if you are adding a chart to to a box in a research note you should set `bg_colour = e61_boxback`. 

The [Graph standards](graph-standards.html) article sets out this workflow in greater detail.

## Graph examples

### Basic scatter graph

```{r}

# Set up data
mtcars2 <- within(mtcars, {
  vs <- factor(vs, labels = c("V-shaped", "Straight"))
  am <- factor(am, labels = c("Automatic", "Manual"))
  cyl  <- factor(cyl)
  gear <- factor(gear)
})

# Graph - only the basics
p1 <- ggplot(mtcars2, aes(x = wt, y = mpg, colour = gear)) +
  geom_point() +
  labs_e61(
    title = "Fuel economy declines as weight increases",
    subtitle = "1973-74",
    sources = "1974 Motor Trend US magazine.",
    x = "Weight (1000 lbs)",
    y = "mpg",
    colour = "Gears"
  )

save_e61(p1, filename = here::here("man/figures/fig-1.svg"), chart_type = "MN")

knitr::include_graphics(here::here("man/figures/fig-1.svg"))

```

### Adding mplot labels and the e61 logo.

```{r}

# Graph - plot labels and logo
p2 <- ggplot(mtcars2) +
  geom_point(aes(x = wt, y = mpg, colour = gear)) +
  mplot_label(label = c("3", "4", "5"),
              x = c(4, 2.7, 2.5),
              y = c(23, 35, 15)) +
  labs_e61(
    title = "Fuel economy declines as weight increases",
    subtitle = "1973-74",
    sources = "1974 Motor Trend US magazine.",
    x = "Weight (1000 lbs)",
    y = "mpg",
    colour = "Gears"
  ) + 
  add_e61_logo()

save_e61(p2, filename = here::here("man/figures/fig-2.svg"), chart_type = "MN")

knitr::include_graphics(here::here("man/figures/fig-2.svg"))

```

### Adding a legend and a legend title

```{r}

# Graph - adding a legend
p3 <- ggplot(mtcars2) +
  geom_point(aes(x = wt, y = mpg, colour = gear)) +
  mplot_label(label = c("3", "4", "5"),
              x = c(4, 2.7, 2.5),
              y = c(23, 35, 15)) +
  labs_e61(
    title = "Fuel economy declines as weight increases",
    subtitle = "1973-74",
    sources = "1974 Motor Trend US magazine.",
    x = "Weight (1000 lbs)",
    y = "mpg",
    colour = "Gears"
  ) + 
  theme_e61(legend = "bottom", legend_title = T)

save_e61(p3, filename = here::here("man/figures/fig-3.svg"), chart_type = "MN")

knitr::include_graphics(here::here("man/figures/fig-3.svg"))

```

### Faceted graph

```{r}
graph <- p1 +
  facet_grid(vs ~ am) +
  theme_e61(legend = "bottom", legend_title = TRUE) +
  scale_colour_e61(n = 3) +
  scale_y_continuous_e61(limits = c(10, 40)) +
  scale_x_continuous_e61()

save_e61(here::here("man/figures/fig-2.svg"), graph)

knitr::include_graphics(here::here("man/figures/fig-2.svg"))


```

### Density graph

```{r}
g <- ggplot(mpg, aes(cty)) + 
  geom_density(aes(fill = factor(cyl)), linetype = "blank", alpha = 0.8) +
  labs_e61(
    title = "Distribution of car city mileage",
    subtitle = "In miles per gallon, by number of cylinders",
    sources = "mpg dataset",
    x = NULL,
    y = "dens",
    fill = "No. cylinders"
  ) +
  mplot_label(label = c("3 cyl", "5 cyl", "6 cyl", "8 cyl"),
              x = c(25, 24, 16, 12),
              y = c(0.1, 0.35, 0.25, 0.25)) +
  theme_e61() +
  scale_y_continuous_e61(limits = c(0, 0.6, 0.2)) +
  scale_x_continuous_e61() +
  scale_fill_e61(n = 4) +
  scale_colour_e61(n = 4) +
  add_e61_logo()

save_e61(here::here("man/figures/fig-3.svg"), g)

knitr::include_graphics(here::here("man/figures/fig-3.svg"))

```

### Line graph

```{r}
df <- economics_long[economics_long$variable %in% c("psavert", "uempmed"), ]
df <- df[year(df$date) %in% c(1967:1981), ]

# plot
graph <- ggplot(df, aes(x = date)) +
  geom_line(aes(y = value, colour = variable), size = 1) +
  # Not using mplot_label just to show how plot_label works
  plot_label("Market returns", as.Date("1969-01-01"), 17, 2, 1) +
  plot_label("Unemployment", as.Date("1973-01-01"), 3, 2, 2) +
  labs_e61(
    title = "Time Series of Returns Percentage*",
    subtitle = "Drawn from long data format",
    footnotes = "Some pointless footnote",
    sources = "Economics",
    x = NULL, y = "%"
  ) + 
  scale_x_date(date_breaks = "3 years", date_labels = "%Y") +
  scale_y_continuous_e61(limits = c(0, 20, 5)) +
  theme_e61() +
  scale_colour_e61(2) +
  add_e61_logo()

save_e61(here::here("man/figures/fig-4.svg"), graph)

knitr::include_graphics(here::here("man/figures/fig-4.svg"))


```

### Column graph

```{r}
col_data <- head(mtcars2, 8)
col_data$names <- rownames(col_data)
col_data$index <- 1:nrow(col_data)

graph <- ggplot(col_data, aes(x = index, y = hp, fill = hp)) +
  geom_col() +
  labs_e61(
    title = "Frivolous Filled Column Chart", 
    subtitle = "For the purpose of showing off the continuous colour palette",
    sources = c("e61 Institute", "Another source"),
    x = NULL, y = "hp") +
  scale_y_continuous_e61(limits = c(0, 250)) +
  theme_e61(legend = "bottom", adj = -15) +
  scale_fill_e61(discrete = FALSE, palette = "light")

save_e61(here::here("man/figures/fig-5.svg"), graph)

knitr::include_graphics(here::here("man/figures/fig-5.svg"))

```

### Horizontal bar chart

```{r}
col_data <- head(mtcars2, 8)
col_data$names <- rownames(col_data)
col_data$index <- 1:nrow(col_data)

graph <- ggplot(col_data, aes(x = factor(index), y = hp, fill = hp)) +
  geom_col() +
  coord_flip() +
  theme_e61(legend = "bottom") +
  labs_e61(
    title = "Frivolous Filled Horizontal Bar Chart", 
    subtitle = "For the purpose of showing off the continuous colour palette",
    sources = c("e61 Institute", "Another source"),
    x = NULL, y = "hp") +
  scale_x_discrete(breaks = 1:8) +
  scale_y_continuous_e61(limits = c(0, 250)) +
  scale_fill_e61(discrete = FALSE, palette = "light") + 
  format_flip()

save_e61(here::here("man/figures/fig-6.svg"), graph)

knitr::include_graphics(here::here("man/figures/fig-6.svg"))

```

